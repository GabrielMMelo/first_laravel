<?php

namespace App\Http\Controllers;

use DB;

use App\advertencia;
use App\membro;
use App\tipo_advertencia;

use Illuminate\Http\Request;
//use Illuminate\Support\facades\Input;

class formController extends Controller
{
    public function pick(){
        $list_membros = membro::all();
        $list_direxes = DB::select('SELECT m.nome FROM membro as m, cargo as c WHERE c.id = m.cargo and c.direx = true');
        $list_tipos_advertencias = tipo_advertencia::all();
        return view('layouts.form', [
        'membros' => $list_membros,
        'direxes' => $list_direxes,
        'advertencias' => $list_tipos_advertencias
        ]);
    }

    public function store(Request $request){
        $nomeTipo = $request->input('tipo');
	$query = DB::table('tipo_advertencia')
                     ->select(DB::raw('id'))	// Cuidado ao usar raw statements -> problemas de injection de vulnerabilidade
                     ->where('nome', '=', $nomeTipo)
                     ->first();	// first() para pegar apenas o primeiro registro da query
        $advertencia = new advertencia;
        $advertencia->tipo = $query->id;	//
        $advertencia->penalizado = $request->input('penalizado');
        $advertencia->responsavel = $request->input('responsavel');
        $advertencia->data = $request->input('data');
        $advertencia->descricao = $request->input('descricao');
        $advertencia->status = 2;
        $advertencia->save();

//        return redirect('form')->with('message', 'Dados enviados com Sucesso!');

//	return $nomeTipo;
//	return view('layouts.welcome');
//	return Redirect::back()->with('message','Operation Successful !');
    }
}

